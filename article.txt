Path: eternal-september.org!mx04.eternal-september.org!feeder.eternal-september.org!.POSTED!not-for-mail
From: Keith Thompson <kst-u@mib.org>
Newsgroups: comp.lang.c
Subject: Re: Teaching C (was Re: hexump.c)
Date: Wed, 14 Sep 2011 13:27:24 -0700
Organization: None to speak of
Message-ID: <lnpqj2amz7.fsf@nuthaus.mib.org>

jacob navia <jacob@spamsink.net> writes:
> Le 14/09/11 14:31, Nobody a Ã©crit:
>> On Tue, 13 Sep 2011 22:44:28 +0200, jacob navia wrote:
>>
>>> 2) Can you tell me of an EXISTING system that sets argv[0] to anything
>>>      else than the name of the program?

Yes.  I just ran the following program:

#include <stdio.h>
int main(int argc, char **argv) {
    for (int i = 0; i <= argc; i ++) {
        printf("argv[%d] = ", i);
        if (argv[i] == NULL) {
            printf("NULL\n");
        }
        else {
            printf("\"%s\"\n", argv[i]);
        }
    }
    return 0;
}

and it gave me this output:

argv[0] = NULL

I just ran it again and got this output:

argv[0] = "argv[0] is a lie"
argv[1] = NULL

Why?  Because I invoked it from a 6-line C program that uses execv().

>> Unless running a script (a file beginning with "#!"), Unix sets argv to
>> exactly what is passed to execve(). If you execute a program with:
>>
>> 	char *arg0 = NULL;
>> 	execve("foo",&arg0, environ);
>>
>> the resulting program will have "argc == 0&&  argv[0] == NULL".
>>
>> Setting argv[0] to the name of the program is only a convention, not
>> something which is enforced by the kernel.
>>
>
> Yes. So, you can crash probably most Unix programs that way.
> So what?

No, I don't believe you can.  It will only crash Unix programs that
don't blindly assume that argv[0] != NULL.  If you find Unix programs
that crash when invoked with argv[0] == NULL, you should consider
reporting it as a bug.

> Most zip/unzip programs are only one program. They look at argv[0]
> to see if they should be unzipping or zipping.

Perhaps so.  info-zip, the default version on Ubuntu, has separate
executables for zip and unzip.  But grep is a good example -- and
at least the GNU version of grep has an explicit check; if argv[0]
== NULL; it reports it as a bug and aborts.  (At least there's code
to do that; I'm not certain that it's actually used.)  I suspect
that most Unix/Linux programs that care abaout the value of argv[0]
do something similar.

> There is no system that doesn't set argv[0] to the name of the program.

It depends on how you invoke the program.  And I wouldn't bet a lot
on the assumption that "the name of the program" is a name that can be
used to invoke it.

> I added a guard (if (argv[0]) in the program as presented in the
> exercise.

Good for you.  We pointed out the possibility that argv[0] isn't
necessarily non-null and you changed the program to allow for it.

So why are you still whining about it?

> One thing you should consider is that the beginner must begin with
> simple programs, not highly secured programs designed to run a simple
> hex dump utility in a 100% secure environment. There is NO point in
> making hexdump.c more complex than it is already.

Then why did you change it?  I'm glad you did, but it seems
inconsistent with what you've been saying.

-- 
Keith Thompson (The_Other_Keith) kst-u@mib.org  <http://www.ghoti.net/~kst>
"We must do something.  This is something.  Therefore, we must do this."
    -- Antony Jay and Jonathan Lynn, "Yes Minister"

